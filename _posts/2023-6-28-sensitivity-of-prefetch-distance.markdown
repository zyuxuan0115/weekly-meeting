---
layout: post
title:  "2023-6-28 prefetch-dis"
date:   2023-6-28 1:53:46 -0500
categories: data-cache
---
### APT-GET on sssp
- According to Saba: APT-GET cannot insert prefetch to sssp
	+ see the email
- should we use this version of sssp? 
- TBD: figure out why APT-GET cannot insert prefetch to bc

### Algorithm for searching optimal prefetch distance
- start from a random point r from [1,100] (?)
- first test the direction for searching 
	+ go rignt if IPC[r+5] >= IPC[r]
	+ go left if IPC[r-5] >= IPC[r]
- then search for the interval for binary search
- binary search

### multiple prefetch location
- have cat16 results
	+ bc & sssp: no big gap between symmetric and asymmetric
	+ symmetric: both prefetch distances are the same
- my question:
	+ check if BOLT successfully insert 2 prefetch instructions to sssp
		* because with 1 prefetch inserted, the optimized binary can outperform the original
	+ also need results on cascade

### Make pg2 support handling the signal from workloads
- after the initialization, a workload sends a `kill(getppid(), SIGUSR1)`
- pg2 blocks and waits for the `SIGUSR1`

### Make pg2 support inserting to multiple prefetch locations at runtime

### finish writing section 3 of the paper - Design of PG2
- In subsection <strong>3.4. code analysis & transformation</strong>, we still need to add an algorithm
	+ decide what predecessor instructions that compute the address for prefetch should be re-executed in the code BOLT inserts
	+ decide if the prefetch will be inserted to outer loop or inner loop
	+ how to check the dependency chain
	+ need to use BOLT's reaching definition (?) to rewrite the `InsertPrefetchPass`. Make it more general.

## Classify workload + input figures
### both bad
- if both of the curves are always worse than the original
![alwaysbad](/assets/2023-06-28/graph_oregon2_010331.png)

### single optimal 
- if any one of the curves has optimal prefetch distance
![hasoptimal](/assets/2023-06-28/graph_public_figure_edges.png)

### range optimal [x, y]
- if any one of the curves has optimal prefetch distance range
![range2](/assets/2023-06-28/graph_soc-Epinions1.png)

### asympototic
- if both of the curves have optimal prefetch distance range [x, +âˆž), x>=0
![range1](/assets/2023-06-28/graph_roadNet-PA.png)

### cat16 good, cascade52 bad
![partialbad1](/assets/2023-06-28/graph_tvshow_edges.png)

### cat16 bad, cascade52 good
![partialbad2](/assets/2023-06-28/graph_higgs-retweet_network.png)

### too noisy  
![noisy](/assets/2023-06-28/graph_facebook_combined.png)

### other

### in the paper we are going to put 3 figures
- in paper's section 1: sssp + graph_loc-gowalla_edges, graph_RO_edges, graph_web-NotreDame on cat16
	+ maybe we need more input curves
- in paper's section 5:
	+ always bad
		* to show that pg2 can roll back to the original code if prefetch is harmful
	+ one good one bad
		* to show that even if prefetch on 1 machine is good, on another machine can be harmful
		* needs make decision on whether we are going to prefetch at runtime 
- want a table to show the numbers of inputs in each catagory.

### measure performance of pg2, APT-GET, hand-prefetch, BOLT
- need to make original binary run for about 1 minute
- BOLTed binary is generated by pg2 in the `pg2_data` directory
	+ only need to use this version of BOLT to measure BOLT performance for once
- pg2's algorithm for searching for the optimal prefetch distance starts from a random number
	+ need to make pg2 run for more than once 
- CRONO workloads have no hand-prefetch - 3 bars
- cgo2017 workloads have hand-prefetch - 4 bars
- need to extend the execution time of randacc and fix nas-is
	+ need result from cascade for nas-is. 
	+ nas-is on cascade might be sensitive to prefetch distance. (though on cat16 it is not)
